{% extends "base.html" %}
{% block title %}–¢–ü {{ process_data['id'] }}{% endblock %}
{% block page_title %}–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å{% endblock %}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/technologist/process.css') }}">
{% endblock %}
{% block content %}
<main class="process-page">
    <section class="process-info-card">
        <h1>–¢–ü {{ process_data['id'] }}</h1>
        <p class="process-note">{{ process_data['note'] }}</p>
    </section>
    {% if role in ['technologist', 'director'] %}
        <div class="management-sections">
            <section class="add-operation-card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
                <form method="post" action="/process/{{ process_data['id'] }}" class="group-form">
                    <div class="form-group">
                        <label for="group">–ì—Ä—É–ø–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π</label>
                        <select id="group" name="group" required>
                            {% for group in group_lib %}
                                {% set code = '0' + group[2]|string if group[2] < 10 else group[2]|string %}
                                <option value="{{ group[2] }}">{{ group[1] }} ({{ code }}00)</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn-secondary">–í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                </form>
                <form method="post" action="/operation-add/{{ process_data['id'] }}" class="operation-form">
                    <div class="form-group">
                        <label for="operation_about">–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                        <input type="text" id="operation_about" name="operation_about" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="operation_time">–í—Ä–µ–º—è (—Å–µ–∫)</label>
                            <input type="number" id="operation_time" name="operation_time" min="1" placeholder="60" required>
                        </div>
                        <div class="form-group">
                            <label for="operation_tool">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
                            <select id="operation_tool" name="operation_tool" required>
                                {% for tool in tools_lib %}
                                    <option value="{{ tool[0] }}">{{ tool[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="operation_gost">–ì–û–°–¢ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                        <select id="operation_gost" name="operation_gost" required>
                            {% for operation in operation_lib %}
                                {% set num = '0' + operation[1]|string if operation[1] < 10 else operation[1]|string %}
                                <option value="{{ operation[0] }}">({{ group_t }}{{ num }}) {{ operation[2] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
                </form>
            </section>
            <section class="assign-device-card">
                <h2>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</h2>
                <form method="post" action="/tp-to-device/{{ process_data['id'] }}" class="assign-form">
                    <div class="form-group">
                        <label for="device_id">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label>
                        <select id="device_id" name="device_id" required>
                            {% for device in device_lib %}
                                <option value="{{ device[0] }}">{{ device[1] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn-secondary">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button>
                </form>
            </section>
        </div>
    {% endif %}
    <section class="operations-section">
        <div class="section-header">
            <h2>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
            {% if operations_data %}
                <span class="operation-count">–í—Å–µ–≥–æ: {{ operations_data|length }}</span>
            {% endif %}
        </div>
        {% if operations_data %}
            <div class="operations-table">
                <div class="operations-header">
                    <div class="col-number">#</div>
                    <div class="col-about">–û–ø–µ—Ä–∞—Ü–∏—è</div>
                    <div class="col-gost">–ì–û–°–¢</div>
                    <div class="col-tools">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                    <div class="col-time">–í—Ä–µ–º—è (—Å)</div>
                    {% if role in ['technologist', 'director'] %}
                        <div class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</div>
                    {% endif %}
                </div>
                {% for op in operations_data %}
                    <div class="operation-row">
                        <div class="col-number">{{ op['number'] }}</div>
                        <div class="col-about">{{ op['about'] }}</div>
                        <div class="col-gost">{{ op['gost_group'] + op['gost_number'] }} ({{ op['gost_name'] }})</div>
                        <div class="col-tools">{{ op['tools'] }}</div>
                        <div class="col-time">{{ op['time'] }}</div>
                        {% if role in ['technologist', 'director'] %}
                            <div class="col-actions">
                                <a href="/operation-delete/{{ op['id'] }}" class="action-btn delete" 
                                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é?')">üóëÔ∏è</a>
                                {% if not loop.first %}
                                    <a href="/operation-high/{{ op['id'] }}" class="action-btn move" title="–ü–æ–¥–Ω—è—Ç—å">‚Üë</a>
                                {% endif %}
                                {% if not loop.last %}
                                    <a href="/operation-low/{{ op['id'] }}" class="action-btn move" title="–û–ø—É—Å—Ç–∏—Ç—å">‚Üì</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="empty-message">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.</p>
        {% endif %}
    </section>
</main>
<footer class="footer footer-with-action">
    <button onclick="window.location.href='/generate-mcard/{{ process_data['id'] }}'" class="mcard-btn">
        –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–Ω—É—é –∫–∞—Ä—Ç—É
    </button>
</footer>
{% endblock %}
