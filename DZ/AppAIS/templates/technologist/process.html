<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–ü {{ process_data['id'] }}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/common.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/technologist/process.css') }}">
</head>
<body>
    <!-- –ï–¥–∏–Ω–∞—è —à–∞–ø–∫–∞ -->
    <header class="main-header">
        <div class="header-title">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å</div>
        <div class="header-nav">
            <a href="/" class="nav-btn">–ì–ª–∞–≤–Ω–∞—è</a>
            {% if role == 'engineer' %}
                <a href="/all-devices" class="nav-btn">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</a>
                <a href="/component-lib" class="nav-btn">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</a>
                <a href="/engineer-help" class="nav-btn">–ü–æ–º–æ—â—å</a>
            {% elif role == 'technologist' %}
                <a href="/tech-processes" class="nav-btn">–¢–µ—Ö. –ø—Ä–æ—Ü–µ—Å—Å—ã</a>
                <a href="/tools" class="nav-btn">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</a>
                <a href="/technologist-help" class="nav-btn">–ü–æ–º–æ—â—å</a>
            {% elif role == 'director' %}
                <a href="/add-tasks" class="nav-btn">–ó–∞–¥–∞—á–∏</a>
                <a href="/staff" class="nav-btn">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
            {% elif role == 'guest' %}
                <a href="/all-devices" class="nav-btn">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</a>
                <a href="/tech-processes" class="nav-btn">–¢–µ—Ö. –ø—Ä–æ—Ü–µ—Å—Å—ã</a>
            {% endif %}
        </div>
        <a href="/user" class="user-avatar"></a>
    </header>

    <main class="process-page">
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ -->
        <section class="process-info-card">
            <h1>–¢–ü {{ process_data['id'] }}</h1>
            <p class="process-note">{{ process_data['note'] }}</p>
        </section>

        <!-- –§–æ—Ä–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∞/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞) -->
        {% if role in ['technologist', 'director'] %}
            <div class="management-sections">
                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
                <section class="add-operation-card">
                    <h2>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
                    <!-- –®–∞–≥ 1: –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã -->
                    <form method="post" action="/process/{{ process_data['id'] }}" class="group-form">
                        <div class="form-group">
                            <label for="group">–ì—Ä—É–ø–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π</label>
                            <select id="group" name="group" required>
                                {% for group in group_lib %}
                                    {% set code = '0' + group[2]|string if group[2] < 10 else group[2]|string %}
                                    <option value="{{ group[2] }}">{{ group[1] }} ({{ code }}00)</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn-secondary">–í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                    </form>

                    <!-- –®–∞–≥ 2: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
                    <form method="post" action="/operation-add/{{ process_data['id'] }}" class="operation-form">
                        <div class="form-group">
                            <label for="operation_about">–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                            <input type="text" id="operation_about" name="operation_about" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–∞–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="operation_time">–í—Ä–µ–º—è (—Å–µ–∫)</label>
                                <input type="number" id="operation_time" name="operation_time" min="1" placeholder="60" required>
                            </div>
                            <div class="form-group">
                                <label for="operation_tool">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</label>
                                <select id="operation_tool" name="operation_tool" required>
                                    {% for tool in tools_lib %}
                                        <option value="{{ tool[0] }}">{{ tool[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="operation_gost">–ì–û–°–¢ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                            <select id="operation_gost" name="operation_gost" required>
                                {% for operation in operation_lib %}
                                    {% set num = '0' + operation[1]|string if operation[1] < 10 else operation[1]|string %}
                                    <option value="{{ operation[0] }}">({{ group_t }}{{ num }}) {{ operation[2] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
                    </form>
                </section>

                <!-- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É -->
                <section class="assign-device-card">
                    <h2>–ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É</h2>
                    <form method="post" action="/tp-to-device/{{ process_data['id'] }}" class="assign-form">
                        <div class="form-group">
                            <label for="device_id">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label>
                            <select id="device_id" name="device_id" required>
                                {% for device in device_lib %}
                                    <option value="{{ device[0] }}">{{ device[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn-secondary">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button>
                    </form>
                </section>
            </div>
        {% endif %}

        <!-- –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <section class="operations-section">
            <div class="section-header">
                <h2>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h2>
                {% if operations_data %}
                    <span class="operation-count">–í—Å–µ–≥–æ: {{ operations_data|length }}</span>
                {% endif %}
            </div>

            {% if operations_data %}
                <div class="operations-table">
                    <div class="operations-header">
                        <div class="col-number">#</div>
                        <div class="col-about">–û–ø–µ—Ä–∞—Ü–∏—è</div>
                        <div class="col-gost">–ì–û–°–¢</div>
                        <div class="col-tools">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                        <div class="col-time">–í—Ä–µ–º—è (—Å)</div>
                        {% if role in ['technologist', 'director'] %}
                            <div class="col-actions">–î–µ–π—Å—Ç–≤–∏—è</div>
                        {% endif %}
                    </div>

                    {% for op in operations_data %}
                        <div class="operation-row">
                            <div class="col-number">{{ op['number'] }}</div>
                            <div class="col-about">{{ op['about'] }}</div>
                            <div class="col-gost">{{ op['gost_group'] + op['gost_number'] }} ({{ op['gost_name'] }})</div>
                            <div class="col-tools">{{ op['tools'] }}</div>
                            <div class="col-time">{{ op['time'] }}</div>
                            {% if role in ['technologist', 'director'] %}
                                <div class="col-actions">
                                    <!-- –£–¥–∞–ª–∏—Ç—å -->
                                    <a href="/operation-delete/{{ op['id'] }}" class="action-btn delete" 
                                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é?')">üóëÔ∏è</a>
                                    <!-- –í–≤–µ—Ä—Ö (–Ω–µ –¥–ª—è –ø–µ—Ä–≤–æ–π) -->
                                    {% if not loop.first %}
                                        <a href="/operation-high/{{ op['id'] }}" class="action-btn move" title="–ü–æ–¥–Ω—è—Ç—å">‚Üë</a>
                                    {% endif %}
                                    <!-- –í–Ω–∏–∑ (–Ω–µ –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π) -->
                                    {% if not loop.last %}
                                        <a href="/operation-low/{{ op['id'] }}" class="action-btn move" title="–û–ø—É—Å—Ç–∏—Ç—å">‚Üì</a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-message">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.</p>
            {% endif %}
        </section>
    </main>

    <!-- –§—É—Ç–µ—Ä —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã -->
    <footer class="footer footer-with-action">
        <button onclick="window.location.href='/generate-mcard/{{ process_data['id'] }}'" class="mcard-btn">
            –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–Ω—É—é –∫–∞—Ä—Ç—É
        </button>
    </footer>
</body>
</html>
