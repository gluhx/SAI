{% extends "base.html" %}
{% block title %}Список устройств{% endblock %}
{% block page_title %}Устройства{% endblock %}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/engineer/devices.css') }}">
{% endblock %}
{% block content %}
<main class="devices-content">
    <h1 class="page-title">Список устройств</h1>
    {% if devices_data %}
        <div class="devices-table">
            <div class="devices-header">
                <div class="col-name">Имя устройства</div>
                <div class="col-desc">Описание</div>
                <div class="col-tp">Тех. процесс</div>
                <div class="col-count">Элементы</div>
                {% if role in ['engineer', 'director'] %}
                    <div class="col-actions">Действия</div>
                {% endif %}
            </div>
            {% for device in devices_data %}
                <div class="device-row" onclick="window.location.href='/device/{{ device['id'] }}'">
                    <div class="col-name">{{ device['name'] }}</div>
                    <div class="col-desc">{{ device['about'][:35] + ('...' if device['about']|length > 35 else '') }}</div>
                    <div class="col-tp">
                        {% if device['TP'] in [None, '', []] %}
                            <span class="tp-missing">Не прикреплён</span>
                        {% else %}
                            {{ device['TP'] }}
                        {% endif %}
                    </div>
                    <div class="col-count">{{ device['count'] }}</div>
                    {% if role in ['engineer', 'director'] %}
                        <div class="col-actions">
                            <a href="/device/delete/{{ device['id'] }}" class="delete-btn" onclick="event.stopPropagation();">Удалить</a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="empty-message">Нет устройств в системе.</p>
    {% endif %}
    {% if role in ['engineer', 'director'] %}
        <div class="add-device-card">
            <h2>Добавить новое устройство</h2>
            <form method="post" action="/add-device" class="add-device-form">
                <div class="form-group">
                    <label for="device_name">Имя устройства</label>
                    <input type="text" id="device_name" name="device_name" placeholder="Например: Блок питания А-200" required>
                </div>
                <div class="form-group">
                    <label for="device_about">Описание</label>
                    <textarea id="device_about" name="device_about" placeholder="Краткое описание устройства" rows="3"></textarea>
                </div>
                <button type="submit" class="btn-primary">Добавить устройство</button>
            </form>
        </div>
    {% endif %}
</main>
<footer class="footer">Хорошего дня!</footer>
{% endblock %}
